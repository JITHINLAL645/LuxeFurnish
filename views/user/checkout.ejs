<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="description" content="Furniture Ecommerce - Checkout">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Amado - Furniture Ecommerce Template | Checkout</title>

        <!-- Favicon -->
        <link rel="icon" href="img/core-img/favicon.ico">

        <!-- Core Style CSS -->
        <link rel="stylesheet" href="css/core-style.css">
        <link rel="stylesheet" href="style.css">

        <!-- Bootstrap CSS -->
        <link
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
            rel="stylesheet">

        <!-- FontAwesome for icons -->
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
            rel="stylesheet">

        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <script
            src="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.9/dist/sweetalert2.all.min.js"></script>

        <style>
        /* Global Styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
            color: #343a40;
        }

        /* .search-wrapper {
            background-color: #007bff;
            color: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .search-wrapper input[type="search"] {
            width: 80%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .search-wrapper button {
            background-color: #ff6f61;
            border: none;
            padding: 10px;
            margin-left: 10px;
            border-radius: 5px;
        }

        .search-wrapper button img {
            width: 20px;
        }

        .header-area {
            background-color: #343a40;
            color: white;
            padding: 20px 0;
        }

        .amado-nav a {
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            display: inline-block;
        }

        .amado-nav a:hover,
        .amado-nav .active {
            background-color: #ff6f61;
            border-radius: 4px;
        } */

        .address-item {
            background-color: #fff;
            padding: 20px;
            margin: 15px 0;
            border-radius: 5px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .address-item p {
    margin: 5px 0;
}

        .address-item .edit-icon {
            background-color: #ff6f61;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .address-item .edit-icon:hover {
            background-color: #ff4d3d;
        }

        .modal-content {
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .modal-header {
            background-color: #343a40;
            color: white;
            border-bottom: none;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-body .form-label {
            font-weight: bold;
        }

        .modal-body .form-control {
            border-radius: 5px;
            border: 1px solid #ddd;
            padding: 10px;
        }

        .btn-primary {
            background-color: #007bff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .social-info a {
            color: #007bff;
            font-size: 18px;
            padding: 10px;
            text-decoration: none;
        }

        .social-info a:hover {
            color: #ff6f61;
        }

        footer {
            background-color: #343a40;
            color: white;
            padding: 20px;
            text-align: center;
        }

        footer a {
            color: #ff6f61;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }
        .payment-method-box {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 20px;
            border-radius: 8px;
            background-color: #f9f9f9;
            width: 300px; /* Smaller box size */
        }

        .payment-method-box h3 {
            font-size: 18px;
            margin-bottom: 15px;
        }

        .payment-method-box label {
            font-weight: 500;
            font-size: 14px;
        }

        .payment-method-box .form-check-label {
            font-size: 14px;
        }
        .coupon-box {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px;
            /* border-radius: 8px; */
            /* background-color: #f9f9f9; */
            width: 450px; /* Adjust the box size */
        }

        .coupon-box h3 {
            font-size: 20px;
            margin-bottom: 15px;
        }

        .coupon-box input {
            width: calc(100% - 100px); /* Adjust input width to leave space for button */
            padding: 8px;
            font-size: 14px;
            margin-right: 10px;
        }

        .coupon-box button {
            width: 150px;
            padding: 8px;
            font-size: 14px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
        }

        .coupon-box button:hover {
            background-color: #0056b3;
        }
         
.cart-card {
    width: 100%;                    
    max-width: 400px;                 
    margin: 20px auto;                
    padding: 20px;                   
    background-color: #ffffff;       
    border: 1px solid #ddd;          
    border-radius: 10px;              
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); 
    text-align: left;                
}

.cart-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 15px;
}

.summary-table {
    list-style: none;                 /* Remove bullets */
    padding: 0;
    margin: 0 0 20px 0;               /* Space between table and button */
}

.summary-table li {
    display: flex;
    justify-content: space-between;   /* Align items on both ends (label and value) */
    padding: 5px 0;                   /* Space between items */
    font-size: 16px;                  /* Text size */
    color: #333;                      /* Darker text color */
}

/* Box container for the button */
.summary-box {
    text-align: center;               /* Center the button inside the box */
    margin-top: 20px;
}

/* Button styling */
.summary-btn {
    width: 100%;                      /* Full width of the box */
    padding: 12px;                    /* Button padding */
    background-color: #007bff;        /* Primary button color */
    color: white;
    border: none;
    font-size: 16px;
    cursor: pointer;
    border-radius: 5px;               /* Rounded button */
    transition: background-color 0.3s ease; /* Smooth transition for hover effect */
}

.summary-btn:hover {
    background-color: #0056b3;        /* Darker blue on hover */
}

.container {
    margin-top: 20px;
}

.card {
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.card-title {
    font-size: 1.5rem;
    margin-bottom: 20px;
}

.form-check {
    margin-bottom: 10px;
}

.price-details {
    border-bottom: 1px solid #ddd;
    padding-top: 15px;
    margin-top: 15px;
}

.summary-table {
    list-style: none;
    padding: 0;
    margin: 0;
}

.summary-table li {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
}

.summary-box {
    margin-top: 20px;
}

.summary-btn {
    padding: 10px 0;
    font-size: 1.1rem;
    font-weight: 500;
}
.edit-icon {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
    border-radius: 4px;
}


.navbar-profile a {
        display: flex;
        align-items: center;
        transition: transform 0.3s ease;
    }

    .navbar-profile a:hover {
        transform: scale(1.1);
    }

    .navbar-profile img {
        border-radius: 50%;
        width: 50px;
        height: 50px;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .navbar-profile img:hover {
        transform: rotate(360deg);
    }
    </style>
        <!-- SweetAlert2 CDN -->
             <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    </head>

    <body>

        <nav class="navbar"
            style="background-color: #3c3c3c; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
            <!-- Navbar Brand with a smooth hover effect -->
            <div class="navbar-brand" style="flex-grow: 1;">
                <a href="/"
                    style="color: #ffffff; font-size: 28px; font-weight: bold; text-decoration: none; 
                    background-image: linear-gradient(to right, #ff6347, #ffbd00); 
                    background-clip: text; -webkit-background-clip: text; color: transparent; 
                    transition: transform 0.3s ease, text-shadow 0.3s ease;">
                    LuxeFurnish
                </a>
            </div>

            <!-- Profile and Log Out Button Section (aligned to the right) -->
            <div
                style="display: flex; align-items: center; justify-content: flex-end;">
                <div class="navbar-wishlist" style="margin-right: 20px;">
                    <a href="/wishlish"
                        style="color: #dd3535; font-size: 24px; display: flex; align-items: center; transition: transform 0.3s ease;">
                        <i class="fa fa-heart" aria-hidden="true"></i>
                    </a>
                </div>

                <!-- Cart Icon -->
                <div class="navbar-cart" style="margin-right: 20px;">
                    <a href="/cart"
                        style="color: #fff; font-size: 24px; display: flex; align-items: center; transition: transform 0.3s ease;">
                        <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                    </a>
                </div>
                <!-- Profile Section -->
                <div class="navbar-profile"
                    style="display: flex; align-items: center; margin-right: 20px;">
                    <a href="/profile" class="btn profile-btn"
                        style="display: flex; align-items: center; transition: transform 0.3s ease;">
                        <img
                            src="data:image/png;base64,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"
                            alt="User Profile"
                            style="border-radius: 50%; width: 50px; height: 50px; object-fit: cover; transition: transform 0.3s ease;">
                    </a>
                </div>
            </div>
        </nav>

        <!-- Search Wrapper Area Start -->
        <div class="search-wrapper section-padding-100">
            <div class="search-close">
                <i class="fa fa-close" aria-hidden="true"></i>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="search-content">
                            <form action="#" method="get">
                                <input type="search" name="search" id="search"
                                    placeholder="Type your keyword...">
                                <button type="submit"><img
                                        src="img/core-img/search.png"
                                        alt></button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Search Wrapper Area End -->

        <!-- Main Content Wrapper Start -->
        <div class="main-content-wrapper d-flex clearfix">
            <header class="header-area clearfix">
                <!-- Close Icon -->
                <div class="nav-close">
                    <i class="fa fa-close" aria-hidden="true"></i>
                </div>
                <!-- Logo -->
                <nav class="amado-nav">
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li><a href="shop">Shop</a></li>
                        <li class="active"><a href="Cart">Cart</a></li>
                        <!-- <li><a href="checkout">Checkout</a></li> -->
                    </ul>
                </nav>
            </header>

            <div class="container">
                <h3 class="h4 text-center my-5">Shipping & Place Order</h3>

                <div class="row">
                    <!-- Shipping Address Section (First Box) -->
                    <div class="col-md-6">
                        <div class="card p-4">
                            <h3 class="card-title">Shipping Address</h3>
                            <div class="section">
                                <% if (addresses && addresses.length > 0) { %>
                                <% addresses.forEach(function(address) { %>
                                <div class="address-item mb-3">
                                    <div>
                                        <input type="radio"
                                            name="selectedAddress"
                                            value="<%= address._id %>"
                                            <%=address.isDefault ? 'checked' :
                                            '' %> class="address-radio">

                                        <!-- id -->
                                        <p><%= address._id || '' %></p>

                                        <!-- Full name -->
                                        <p><%= address.firstName || '' %> <%=
                                            address.lastName || '' %></p>

                                        <!-- Phone number -->
                                        <p><%= address.phoneNumber ||
                                            'No phone number provided' %></p>

                                        <!-- Email -->
                                        <p><%= address.email ||
                                            'No email provided' %></p>

                                        <!-- Address fields with conditional checks -->
                                        <p>
                                            <%= address.addressLine || '' %>,
                                            <%= address.street || '' %>,
                                            <%= address.place || '' %>,
                                            <%= address.city || '' %>,
                                            <%= address.district || '' %>,
                                            <%= address.state || '' %>,
                                            <%= address.country || '' %> -
                                            <%= address.pincode || '' %>
                                        </p>
                                    </div>
                                    <button class="edit-icon"
                                        onclick="openEditModal('<%= address._id %>', '<%= address.firstName %>', '<%= address.lastName %>', '<%= address.phoneNumber %>', '<%= address.email %>', '<%= address.addressLine %>', '<%= address.place %>', '<%= address.street %>', '<%= address.city %>', '<%= address.district %>', '<%= address.state %>', '<%= address.country %>', '<%= address.pincode %>')">Edit</button>
                                </div>
                                <% }) %>
                                <% } else { %>
                                <p>No addresses found.</p>
                                <% } %>
                            </div>
                        </div>
                    </div>

                    <!-- Payment and Price Details Section (Second Box) -->
                   <div class="col-md-6">
    <div class="col-md-6 coupon-list-container">
        <h4 class="mb-4">Available Coupons</h4>
        <% if (availableCoupons && availableCoupons.length > 0) { %>
        <% availableCoupons.forEach(coupon => { %>
        <div class="coupon-item d-flex justify-content-between align-items-center p-3 mb-2 border rounded bg-light">
            <div>
                <span class="coupon-code h5 text-primary"><%= coupon.code %></span>
                <p class="coupon-description text-muted small mb-0"><%= coupon.description %></p>
            </div>
            <button class="btn btn-outline-primary btn-sm" onclick="copyCouponCode('<%= coupon.code %>')">
                Copy Code
            </button>
        </div>
        <% }) %>
        <% } else { %>
        <p>No available coupons at the moment.</p>
        <% } %>
    </div>

    <div class="card p-4">
        <div class="coupon-box p-4 rounded shadow-lg bg-light">
            <h3 class="text-center mb-4">Coupon</h3>
            <div class="form-group">
                <form method="post" id="coupon-form" action="/apply-coupon">
                    <input type="text" class="form-control" id="couponCode" name="couponCode"
                        placeholder="Enter coupon code" required>
                    <button type="submit" id="couponButton" class="btn btn-primary mt-3 w-100"
                        style="background-color: #fbb710; border-color: rgb(213, 213, 207);">
                        Apply Coupon
                    </button>
                </form>
            </div>
        </div>

        <div class="price-details mt-4">
            <h5 class="cart-title">Price Details</h5>
            <ul class="summary-table">
                <li><span>Subtotal:</span> <span id="checkout-subtotal">$<%= totalAmount.toFixed(2) %></span></li>
                <li><span>Delivery:</span> <span>$50.00</span></li>
                <li><span>Discount:</span> <span id="couponDiscount">$0.00</span></li>
                <hr>
                <li><span>Total:</span> <span id="checkout-total">$<%= (totalAmount + 50).toFixed(2) %></span></li>
            </ul>
        </div>

        <h3 class="card-title">Select Payment Method</h3>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="paymentMethod" id="razorpay" value="razorpay" required>
            <label class="form-check-label" for="razorpay">Razorpay</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="paymentMethod" id="wallet" value="wallet" required>
            <label class="form-check-label" for="wallet">Wallet</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="paymentMethod" id="cashOnDelivery"
                value="cashOnDelivery" required>
            <label class="form-check-label" for="cashOnDelivery">Cash on Delivery</label>
        </div>

        <form id="chekoutform">
            <input type="hidden" name="deliveryAddress" id="deliveryAddress" value="">
            <input type="hidden" name="estimatedDelivery" value="<%= estimatedDelivery %>">
            <input type="hidden" name="cartItems" value='<%= JSON.stringify(cartItems) %>'>

            <div class="summary-box mt-4">
                <button type="submit" class="btn btn-primary summary-btn w-100" id="placeOrderBtn">Place Order</button>
            </div>
        </form>
    </div>
</div>
       

                </div>
            </div>

        </div>

        <div class="modal fade" id="editAddressModal" tabindex="-1"
            aria-labelledby="editAddressModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editAddressModalLabel">Edit
                            Address</h5>
                        <button type="button" class="btn-close"
                            data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="editAddressForm"
                            action="/checkoutupdateAddress" method="POST">
                            <input type="hidden" id="addressId" name="id">

                            <div class="mb-3">
                                <label for="editFirstName"
                                    class="form-label">First Name</label>
                                <input type="text" class="form-control"
                                    id="editFirstName" name="first_name"
                                    required>
                            </div>

                            <div class="mb-3">
                                <label for="editLastName"
                                    class="form-label">Last Name</label>
                                <input type="text" class="form-control"
                                    id="editLastName" name="last_name" required>
                            </div>

                            <div class="mb-3">
                                <label for="editMobile"
                                    class="form-label">Mobile</label>
                                <input type="tel" class="form-control"
                                    id="editMobile" name="phone_number"
                                    required>
                            </div>

                            <div class="mb-3">
                                <label for="editEmail"
                                    class="form-label">Email</label>
                                <input type="email" class="form-control"
                                    id="editEmail" name="email" required>
                            </div>

                            <div class="mb-3">
                                <label for="editAddress"
                                    class="form-label">Address</label>
                                <input type="text" class="form-control"
                                    id="editAddress" name="street_address"
                                    required>
                            </div>

                            <div class="mb-3">
                                <label for="editCity"
                                    class="form-label">City</label>
                                <input type="text" class="form-control"
                                    id="editCity" name="city" required>
                            </div>

                            <div class="mb-3">
                                <label for="editState"
                                    class="form-label">State</label>
                                <input type="text" class="form-control"
                                    id="editState" name="state" required>
                            </div>

                            <div class="mb-3">
                                <label for="editCountry"
                                    class="form-label">Country</label>
                                <input type="text" class="form-control"
                                    id="editCountry" name="country" required>
                            </div>

                            <div class="mb-3">
                                <label for="editPinCode" class="form-label">Pin
                                    Code</label>
                                <input type="text" class="form-control"
                                    id="editPinCode" name="zipCode" required>
                            </div>

                            <button type="submit" class="btn btn-primary">Update
                                Address</button>
                        </form>

                    </div>
                </div>
            </div>
        </div>

        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
        <script
            src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
            <script
                        src="https://checkout.razorpay.com/v1/checkout.js"></script>


                        
<script>
    let appliedCoupon = false;
    let originalTotalAmount = <%= totalAmount %>;

    // Copy coupon code functionality
    function copyCouponCode(couponCode) {
        document.getElementById('couponCode').value = couponCode;
    }

    // Apply Coupon Functionality
    document.getElementById('coupon-form').addEventListener('submit', function (e) {
        e.preventDefault();
        if (!appliedCoupon) {
            applyCoupon();
        } else {
            removeCoupon();
        }
    });

    function applyCoupon() {
        const couponCode = document.getElementById('couponCode').value;

        if (couponCode) {
            // Simulate applying a coupon
            const discount = 100; // Set a discount amount
            const newTotal = originalTotalAmount + 50 - discount;

            document.getElementById('couponDiscount').innerText = `$${discount.toFixed(2)}`;
            document.getElementById('checkout-total').innerText = `$${newTotal.toFixed(2)}`;

            // Change Apply button to Remove button
            const couponButton = document.getElementById('couponButton');
            couponButton.innerText = 'Remove Coupon';
            couponButton.style.backgroundColor = '#dc3545';
            couponButton.style.borderColor = '#dc3545';

            appliedCoupon = true;
        }
    }

    // Remove Coupon Functionality
    function removeCoupon() {
        const couponButton = document.getElementById('couponButton');

        // Reset discount and total values
        document.getElementById('couponDiscount').innerText = '$0.00';
        document.getElementById('checkout-total').innerText = `$${(originalTotalAmount + 50).toFixed(2)}`;

        // Reset the coupon form
        document.getElementById('couponCode').value = '';

        // Change Remove button back to Apply Coupon button
        couponButton.innerText = 'Apply Coupon';
        couponButton.style.backgroundColor = '#fbb710';
        couponButton.style.borderColor = 'rgb(213, 213, 207)';

        appliedCoupon = false;
    }
</script>

            

                        <script>
                            function copyCouponCode(code) {
                              navigator.clipboard.writeText(code).then(() => {
                                Swal.fire({
                                  title: 'Copied!',
                                  text: 'Coupon code copied to clipboard successfully',
                                  icon: 'success'
                                });
                              }).catch(err => {
                                console.error('Error copying coupon code:', err);
                              });
                            }
                          </script>


                        <script>
    document.getElementById('coupon-form').addEventListener('submit', function(event) {
        event.preventDefault();  // Prevent the default form submission (page reload)

        const couponCode = document.getElementById('couponCode').value;
        console.log("couponcode:", couponCode);  // Log to verify the coupon code

        const data = {
    couponCode: couponCode
};

// Send the JSON data to the backend
fetch('/apply-coupon', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'  // Set the Content-Type to JSON
    },
    body: JSON.stringify(data)  // Send the data as JSON
})
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update the UI with the discount and total amount
                document.getElementById('couponDiscount').textContent = `$${data.discountAmount.toFixed(2)}`;
                document.getElementById('checkout-total').textContent = `$${data.finalAmount.toFixed(2)}`;
            } else {
                alert(data.message);  // Show an error if coupon is invalid
            }
        })
        .catch(error => {
            console.error('Error applying coupon:', error);
            alert('An error occurred while applying the coupon.');
        });
    });
</script>


                            <script>
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('placeOrderBtn').addEventListener('click', function(event) {
        const selectedAddress = document.querySelector('input[name="selectedAddress"]:checked');
        if (!selectedAddress) {
          alert("Please select a shipping address.");
          event.preventDefault(); // Prevent form submission
          return;
        }
  
        const selectedPaymentMethod = document.querySelector('input[name="paymentMethod"]:checked');
        if (!selectedPaymentMethod) {
          alert("Please select a payment method.");
          event.preventDefault(); // Prevent form submission
          return;
        }
  
        const addressId = selectedAddress.value;
        const selectedAddressDetails = addresses.find(address => address._id === addressId);
  
        if (selectedAddressDetails) {
          document.getElementById('deliveryAddress').value = JSON.stringify(selectedAddressDetails);
        }
  
        // Subtotal (without tax)
        const subtotal = parseFloat("<%= totalAmount %>");
        const deliveryFee = 50.00;
        
        // Apply discount (for example, a 10% discount)
        const discountPercentage = 10; // You can change this value
        const discountAmount = (subtotal * discountPercentage) / 100;
  
        // Calculate the total without tax and with discount
        const totalBeforeDiscount = subtotal + deliveryFee;
        const totalAfterDiscount = totalBeforeDiscount - discountAmount;
  
        // Update the display
        document.getElementById('subtotal').textContent = `₹${subtotal.toFixed(2)}`;
        document.getElementById('deliveryFee').textContent = `₹${deliveryFee.toFixed(2)}`;
        document.getElementById('discountAmount').textContent = `-₹${discountAmount.toFixed(2)}`;
        document.getElementById('totalAmount').textContent = `₹${totalAfterDiscount.toFixed(2)}`;
      });
    });
</script>
                     <script>
                        document.getElementById('rzp-button').onclick = async function (e) {
                            e.preventDefault();
                    
                            const response = await fetch('/Razorpayorder', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    amount: 500, // 500 INR
                                    currency: 'INR',
                                    receipt: 'order_rcptid_11'
                                })
                            });
                    
                            const orderData = await response.json();

                            console.log(orderData)
                    
                            const options = {
                                "key": "<%= process.env.RAZORPAY_KEY_ID %>", // Enter the Key ID generated from the Dashboard
                                "amount": orderData.amount, 
                                "currency": orderData.currency,
                                "name": "Your Store Name",
                                "description": "Test Transaction",
                                "order_id": orderData.id, 
                                "handler": async function (response) {
                                    const paymentDetails = {
                                        razorpay_order_id: response.razorpay_order_id,
                                        razorpay_payment_id: response.razorpay_payment_id,
                                        razorpay_signature: response.razorpay_signature
                                    };
                    
                                    const verifyResponse = await fetch('/verifyPayment', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        },
                                        body: JSON.stringify(paymentDetails)
                                    });
                    
                                    const result = await verifyResponse.json();
                                    if (result.success) {
                                        alert("Payment Successful!");
                                    } else {
                                        alert("Payment Verification Failed");
                                    }
                                },
                                "theme": {
                                    "color": "#3399cc"
                                }
                            };
                    
                            const rzp = new Razorpay(options);
                            rzp.open();
                        };
                    </script>

                    <script>
                document.addEventListener('DOMContentLoaded', function() {
                  const subtotal = localStorage.getItem('subtotal');
                  const total = localStorage.getItem('total');
        
                  if (subtotal && total) {
                    document.getElementById('checkout-subtotal').innerText = subtotal;
                    document.getElementById('checkout-total').innerText = total;
                  }
                });
              </script>

        <script>
        // Open edit modal with pre-filled data
        function openEditModal(id, firstName, lastName, mobile, email, address, city, state, country, pinCode) {
            document.getElementById('addressId').value = id;
            document.getElementById('editFirstName').value = firstName;
            document.getElementById('editLastName').value = lastName;
            document.getElementById('editMobile').value = mobile;
            document.getElementById('editEmail').value = email;
            document.getElementById('editAddress').value = address;
            document.getElementById('editCity').value = city;
            document.getElementById('editState').value = state;
            document.getElementById('editCountry').value = country;
            document.getElementById('editPinCode').value = pinCode;

            $('#editAddressModal').modal('show');
        }
    </script>

    <script>
        document.getElementById("chekoutform").addEventListener("submit", async (event) => {
    event.preventDefault(); // Prevent default form submission

    const selectedAddress = document.querySelector('input[name="selectedAddress"]:checked');

    if (!selectedAddress) {
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Please select a shipping address.',
        });
        return;
    }

    document.getElementById("deliveryAddress").value = selectedAddress.value;

    // Gather the other form data
    const data = {};
    const subtotalText = document.getElementById("checkout-total").textContent;
    data.totalAmount = parseFloat(subtotalText.replace('$', '').trim());  // Convert to float after removing $

    console.log("Total Amount:", data.totalAmount);

    data.deliveryAddress = selectedAddress.value;
    data.estimatedDelivery = document.querySelector('input[name="estimatedDelivery"]').value;
    data.cartItems = document.querySelector('input[name="cartItems"]').value;

    data.email = selectedAddress.dataset.email || '';  
    data.phoneNumber = selectedAddress.dataset.phoneNumber || '';
    data.pincode = selectedAddress.dataset.pincode || '';

    console.log("Data for order:", data);

    const selectedPaymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;

    // Check if payment method is "Cash on Delivery" and totalAmount is above 1000
    if (selectedPaymentMethod === 'cashOnDelivery' && data.totalAmount > 1000) {
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Cash on Delivery is only available for orders below $1000.',
        });
        return; // Prevent form submission if the condition is met
    }

    if (selectedPaymentMethod === 'razorpay') {
        const response = await fetch('/Razorpayorder', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                amount: data.totalAmount, // Send amount in INR, backend will convert to paise
                currency: 'INR',
                receipt: 'order_rcptid_11'
            })
        });

        const orderData = await response.json();
        if (orderData.id) {
            const options = {
                "key": "<%= process.env.RAZORPAY_KEY_ID %>", 
                "amount": orderData.amount, 
                "currency": orderData.currency,
                "name": "LuxeFrunish",
                "description": "Test Transaction",
                "order_id": orderData.id,
                "handler": async function (paymentResponse) {
                    const paymentDetails = {
                        razorpay_order_id: paymentResponse.razorpay_order_id,
                        razorpay_payment_id: paymentResponse.razorpay_payment_id,
                        razorpay_signature: paymentResponse.razorpay_signature
                    };
                    const combinedDetails = Object.assign({}, paymentDetails, data);

                    const verifyResponse = await fetch('/verifyPayment', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(combinedDetails)
                    });

                    const result = await verifyResponse.json();
                    if (result.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Payment Successful!',
                            text: 'Your payment has been successfully processed.',
                        });
                        window.location = '/successpage';  
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Payment Verification Failed',
                            text: 'We could not verify your payment. Please try again.',
                        });
                    }
                },
                "theme": {
                    "color": "#3399cc"
                }
            };

            const rzp = new Razorpay(options);
            rzp.open();
        } else {
            Swal.fire({
                icon: 'error',
                title: 'Error creating Razorpay order',
                text: 'Please try again later.',
            });
        }
    } else {
        const response = await fetch("/placeorder", {
            method: "POST",
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });

        if (response.ok) {
            console.log("Order placed successfully");
            Swal.fire({
                icon: 'success',
                title: 'Order Placed!',
                text: 'Your order has been successfully placed.',
            });
            window.location = '/successpage';  
        } else {
            Swal.fire({
                icon: 'error',
                title: 'Failed to Place Order',
                text: 'We encountered an issue while placing your order. Please try again.',
            });
        }
    }
});

        </script>

    </body>

</html>
<%- include("../../views/partials/user/footer") %>
